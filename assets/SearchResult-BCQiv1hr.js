import{u as O,f as X,h as ee,i as U,j as le,k as ae,t as se,l as te,m as D,p as b,q as he,s as F,v as a,x as M,y as B,R as G,z as ne,A as oe,B as re,C as ie,D as ue,E as ce,F as me,G as ve,H as de,I as pe,J as we,K as ye,L as ze,M as L}from"./app-0mQufz6n.js";const fe=["/","/zh-hant/","/zh-hans/DE.html","/zh-hans/UP.html","/zh-hans/assets.html","/zh-hans/","/zh-hans/md.html","/zh-hans/sitehelp.html","/zh-hans/account/Google.html","/zh-hans/account/IOS.html","/zh-hans/account/apkxa.html","/zh-hans/account/","/zh-hans/markdown/","/zh-hans/mw/MW-Press.html","/zh-hans/mw/game-info.html","/zh-hans/mw/","/zh-hans/mwt/","/zh-hans/markdown/other/","/zh-hans/mw/collection/EGG.html","/zh-hans/mw/collection/LJ.html","/zh-hans/mw/collection/Market.html","/zh-hans/mw/collection/cn.html","/zh-hans/mw/collection/ct.html","/zh-hans/mw/collection/ctto.html","/zh-hans/mw/collection/events-less.html","/zh-hans/mw/collection/","/zh-hans/mw/collection/musk.html","/zh-hans/mw/collection/mw68.html","/zh-hans/mw/collection/mw70.html","/zh-hans/mw/collection/news.html","/zh-hans/mw/collection/pan.html","/zh-hans/mw/column/UAV.html","/zh-hans/mw/column/bomber.html","/zh-hans/mw/column/fighter.html","/zh-hans/mw/column/helicopter.html","/zh-hans/mw/column/","/zh-hans/mw/download/PC.html","/zh-hans/mw/download/ZG.html","/zh-hans/mw/download/app.html","/zh-hans/mw/download/","/zh-hans/mw/download/mod.html","/zh-hans/mw/download/sys.html","/zh-hans/mw/official/BP.html","/zh-hans/mw/official/BS.html","/zh-hans/mw/official/JD.html","/zh-hans/mw/official/LT.html","/zh-hans/mw/official/QT.html","/zh-hans/mw/official/SC.html","/zh-hans/mw/official/SD.html","/zh-hans/mw/official/WF.html","/zh-hans/mw/official/YJ.html","/zh-hans/mw/official/ZB.html","/zh-hans/mw/official/ZD.html","/zh-hans/mw/official/ZH.html","/zh-hans/mw/official/ZY.html","/zh-hans/mw/official/","/zh-hans/mw/skills/CYCT.html","/zh-hans/mw/skills/Game.html","/zh-hans/mw/skills/MOM.html","/zh-hans/mw/skills/STAN-Bilibili.html","/zh-hans/mw/skills/X51.html","/zh-hans/mw/skills/","/zh-hans/mw/skills/mw-rules.html","/zh-hans/markdown/other/emoji/nature.html","/zh-hans/markdown/other/emoji/object.html","/zh-hans/markdown/other/emoji/people.html","/zh-hans/markdown/other/emoji/place.html","/zh-hans/markdown/other/emoji/symbol.html","/404.html","/zh-hans/markdown/other/emoji/"],ke="SEARCH_PRO_QUERY_HISTORY",v=O(ke,[]),ge=()=>{const{queryHistoryCount:s}=L,t=s>0;return{enabled:t,queryHistory:v,addQueryHistory:h=>{t&&(v.value.length<s?v.value=Array.from(new Set([h,...v.value])):v.value=Array.from(new Set([h,...v.value.slice(0,s-1)])))},removeQueryHistory:h=>{v.value=[...v.value.slice(0,h),...v.value.slice(h+1)]}}},A=s=>fe[s.id]+("anchor"in s?`#${s.anchor}`:""),He="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:q}=L,d=O(He,[]),Re=()=>{const s=q>0;return{enabled:s,resultHistory:d,addResultHistory:t=>{if(s){const h={link:A(t),display:t.display};"header"in t&&(h.header=t.header),d.value.length<q?d.value=[h,...d.value]:d.value=[h,...d.value.slice(0,q-1)]}},removeResultHistory:t=>{d.value=[...d.value.slice(0,t),...d.value.slice(t+1)]}}},Qe=s=>{const t=ue(),h=U(),{search:H,terminate:c}=ce(),w=D(!1),y=me([]);return ve(()=>{const p=()=>{y.value=[],w.value=!1},R=ze(z=>{w.value=!0,z?H({type:"search",query:z,locale:h.value,options:t}).then(m=>{y.value=m,w.value=!1}).catch(m=>{console.error(m),p()}):p()},L.searchDelay);F([s,h],()=>R(s.value),{immediate:!0}),de(()=>{c()})}),{searching:w,results:y}};var xe=X({name:"SearchResult",props:{query:{type:String,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(s,{emit:t}){const h=ee(),H=U(),c=le(ae),{enabled:w,addQueryHistory:y,queryHistory:p,removeQueryHistory:R}=ge(),{enabled:z,resultHistory:m,addResultHistory:T,removeResultHistory:I}=Re(),j=w||z,Q=se(s,"query"),{results:f,searching:Y}=Qe(Q),n=te({isQuery:!0,index:0}),i=D(0),u=D(0),E=b(()=>j&&(p.value.length>0||m.value.length>0)),S=b(()=>f.value.length>0),x=b(()=>f.value[i.value]||null),_=()=>{const{isQuery:e,index:l}=n;l===0?(n.isQuery=!e,n.index=e?m.value.length-1:p.value.length-1):n.index=l-1},J=()=>{const{isQuery:e,index:l}=n;l===(e?p.value.length-1:m.value.length-1)?(n.isQuery=!e,n.index=0):n.index=l+1},Z=()=>{i.value=i.value>0?i.value-1:f.value.length-1,u.value=x.value.contents.length-1},V=()=>{i.value=i.value<f.value.length-1?i.value+1:0,u.value=0},W=()=>{u.value<x.value.contents.length-1?u.value+=1:V()},K=()=>{u.value>0?u.value-=1:Z()},C=e=>e.map(l=>pe(l)?l:a(l[0],l[1])),N=e=>{if(e.type==="customField"){const l=we[e.index]||"$content",[o,g=""]=ye(l)?l[H.value].split("$content"):l.split("$content");return e.display.map(r=>a("div",C([o,...r,g])))}return e.display.map(l=>a("div",C(l)))},k=()=>{i.value=0,u.value=0,t("updateQuery",""),t("close")};return he("keydown",e=>{if(s.isFocusing){if(S.value){if(e.key==="ArrowUp")K();else if(e.key==="ArrowDown")W();else if(e.key==="Enter"){const l=x.value.contents[u.value];y(s.query),T(l),h.push(A(l)),k()}}else if(z){if(e.key==="ArrowUp")_();else if(e.key==="ArrowDown")J();else if(e.key==="Enter"){const{index:l}=n;n.isQuery?(t("updateQuery",p.value[l]),e.preventDefault()):(h.push(m.value[l].link),k())}}}}),F([i,u],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["search-pro-result-wrapper",{empty:Q.value?!S.value:!E.value}],id:"search-pro-results"},Q.value===""?j?E.value?[w?a("ul",{class:"search-pro-result-list"},a("li",{class:"search-pro-result-list-item"},[a("div",{class:"search-pro-result-title"},c.value.queryHistory),p.value.map((e,l)=>a("div",{class:["search-pro-result-item",{active:n.isQuery&&n.index===l}],onClick:()=>{t("updateQuery",e)}},[a(M,{class:"search-pro-result-type"}),a("div",{class:"search-pro-result-content"},e),a("button",{class:"search-pro-remove-icon",innerHTML:B,onClick:o=>{o.preventDefault(),o.stopPropagation(),R(l)}})]))])):null,z?a("ul",{class:"search-pro-result-list"},a("li",{class:"search-pro-result-list-item"},[a("div",{class:"search-pro-result-title"},c.value.resultHistory),m.value.map((e,l)=>a(G,{to:e.link,class:["search-pro-result-item",{active:!n.isQuery&&n.index===l}],onClick:()=>{k()}},()=>[a(M,{class:"search-pro-result-type"}),a("div",{class:"search-pro-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(o=>C(o)).flat())]),a("button",{class:"search-pro-remove-icon",innerHTML:B,onClick:o=>{o.preventDefault(),o.stopPropagation(),I(l)}})]))])):null]:c.value.emptyHistory:c.value.emptyResult:Y.value?a(ne,{hint:c.value.searching}):S.value?a("ul",{class:"search-pro-result-list"},f.value.map(({title:e,contents:l},o)=>{const g=i.value===o;return a("li",{class:["search-pro-result-list-item",{active:g}]},[a("div",{class:"search-pro-result-title"},e||c.value.defaultTitle),l.map((r,$)=>{const P=g&&u.value===$;return a(G,{to:A(r),class:["search-pro-result-item",{active:P,"aria-selected":P}],onClick:()=>{y(s.query),T(r),k()}},()=>[r.type==="text"?null:a(r.type==="title"?oe:r.type==="heading"?re:ie,{class:"search-pro-result-type"}),a("div",{class:"search-pro-result-content"},[r.type==="text"&&r.header?a("div",{class:"content-header"},r.header):null,a("div",N(r))])])})])})):c.value.emptyResult)}});export{xe as default};
